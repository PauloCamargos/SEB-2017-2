
<!-- saved from url=(0058)http://www.planetb.ca/projects/syntaxHighlighter/popup.php -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<link type="text/css" rel="stylesheet" href="./popup.php_files/SyntaxHighlighter.css">
		<script language="javascript" src="./popup.php_files/shCore.js.download"></script>
		<script language="javascript" src="./popup.php_files/shBrushCpp.js.download"></script>
		<script language="javascript" src="./popup.php_files/shBrushXml.js.download"></script>
	<style type="text/css">.dp-cpp .datatypes { color: #2E8B57; font-weight: bold; }</style></head>
	<body>
		<div class="dp-highlighter"><div class="bar"></div><ol start="1" class="dp-cpp"><li class="alt"><span><span class="preprocessor">#define&nbsp;pinSensor&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A9&nbsp;//&nbsp;Vout&nbsp;pin</span><span>&nbsp;&nbsp;</span></span></li><li class=""><span><span class="preprocessor">#define&nbsp;pinReferencia&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A8</span><span>&nbsp;&nbsp;</span></span></li><li class="alt"><span><span class="preprocessor">#define&nbsp;pinStart&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;8</span><span>&nbsp;&nbsp;</span></span></li><li class=""><span><span class="preprocessor">#define&nbsp;pinKp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A2</span><span>&nbsp;&nbsp;</span></span></li><li class="alt"><span><span class="preprocessor">#define&nbsp;pinPWM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;11</span><span>&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span><span class="keyword">void</span><span>&nbsp;setup()&nbsp;{&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;pinMode(pinStart,&nbsp;INPUT_PULLUP);&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;pinMode(pinPWM,&nbsp;OUTPUT);&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;Serial.begin(115200);&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;analogReadResolution(12);&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;analogWriteResolution(12);&nbsp;&nbsp;</span></li><li class="alt"><span>}&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span><span class="keyword">void</span><span>&nbsp;loop()&nbsp;{&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;<span class="keyword">if</span><span>&nbsp;(!digitalRead(pinStart))&nbsp;{&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="datatypes">int</span><span>&nbsp;Vout&nbsp;=&nbsp;analogRead(pinSensor);&nbsp;&nbsp;&nbsp;</span><span class="comment">//&nbsp;Reading&nbsp;capacitor&nbsp;voltage</span><span>&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="datatypes">int</span><span>&nbsp;ref&nbsp;=&nbsp;analogRead(pinReferencia);&nbsp;&nbsp;</span><span class="comment">//&nbsp;Reading&nbsp;reference&nbsp;voltage</span><span>&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="datatypes">int</span><span>&nbsp;erro&nbsp;=&nbsp;ref&nbsp;-&nbsp;Vout;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="datatypes">int</span><span>&nbsp;Kp&nbsp;=&nbsp;analogRead(pinKp)&nbsp;*&nbsp;20&nbsp;/&nbsp;4095.0;&nbsp;</span><span class="comment">//&nbsp;0&nbsp;&lt;&nbsp;Kp&nbsp;&lt;&nbsp;20.&nbsp;Ajustable&nbsp;as&nbsp;potenciometer</span><span>&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="datatypes">int</span><span>&nbsp;P&nbsp;=&nbsp;erro&nbsp;*&nbsp;Kp;&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;Returns</span><span>&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;#&nbsp;P,&nbsp;if&nbsp;0&nbsp;&lt;&nbsp;P&nbsp;&lt;&nbsp;4095;</span><span>&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;#&nbsp;0,&nbsp;if&nbsp;P&lt;0;</span><span>&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;#&nbsp;4095,&nbsp;if&nbsp;P&gt;4095.&nbsp;</span><span>&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;P&nbsp;=&nbsp;constrain(P,&nbsp;0,&nbsp;4095);&nbsp;&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;analogWrite(DAC1,&nbsp;P);&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;Serial.println(<span class="string">"Kp:&nbsp;"</span><span>&nbsp;+&nbsp;(String)&nbsp;Kp&nbsp;+&nbsp;&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"|&nbsp;P:&nbsp;"</span><span>&nbsp;+&nbsp;(String)&nbsp;P&nbsp;+&nbsp;</span><span class="string">"|&nbsp;Ref:&nbsp;"</span><span>&nbsp;+&nbsp;(String)&nbsp;ref&nbsp;+&nbsp;</span><span class="string">"|&nbsp;Vout:&nbsp;"</span><span>&nbsp;+&nbsp;(String)&nbsp;Vout);&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;analogWrite(pinPWM,&nbsp;P);&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li class="alt"><span>}&nbsp;&nbsp;</span></li></ol></div>
			<script language="javascript">
		<!--
			dp.SyntaxHighlighter.HighlightAll('code', true,false);
			document.body.removeChild(document.getElementById("code"));
	  -->
	</script>

</body></html>